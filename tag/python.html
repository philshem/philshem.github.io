<!DOCTYPE html><html lang=en> <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Small Data - python</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css><link rel=stylesheet href=https://smalldata.dev/theme/css/main.557acf99.css><style media=print>.is-hidden-print{display:none !important}</style><link rel=stylesheet href=https://smalldata.dev/custom.css></head> <body id=index class=home> <header class="hero is-primary"> <div class=hero-head> <div class=container> <nav class=navbar> <div class=navbar-brand> <a href=https://smalldata.dev/ class="navbar-item title is-3">Small Data</a> </div> </nav> </div> </div> </header> <nav class="navbar has-shadow is-hidden-print"> <div class=container> <div class=navbar-center></div> <span id=navToggle class=navbar-burger> <span></span> <span></span> <span></span> </span> <div id=navMenu class=navbar-menu> <div class=navbar-end> <a class="navbar-item is-tab" href=/about.html>About</a> <a class="navbar-item is-tab" href=/archives.html>All posts</a> </div> </div> </div> </nav> <div class=container> <div class="section columns"> <div class="column is-three-quarters-desktop is-two-thirds-tablet"> <aside id=featured class=body> <article> <h1 class=title> <a href=https://smalldata.dev/posts/favicon-mosaic/ >Fun with Favicons</a> </h1> <footer class=post-info> <abbr class=published title=2019-04-17T12:00:00+02:00> Published <span class=is-info>Wed 17 April 2019</span> in <a href=https://smalldata.dev/category/programming.html>programming</a> </abbr> <p class=author> <em>by Philip Shemella </em> <span class="tag is-small is-rounded"> <a href=https://smalldata.dev/tag/python.html>python</a> </span> <span class="tag is-small is-rounded"> <a href=https://smalldata.dev/tag/open-data.html>open data</a> </span> <span class="tag is-small is-rounded"> <a href=https://smalldata.dev/tag/3-min-read.html>3 min read</a> </span> </p> </footer> <div class=section> <p>A recent <a href=https://opendata.stackexchange.com/q/14007/1511>question</a> on the Open Data Stack Exchange site got me thinking about how to download favicons from a bulk list of websites.</p> <h3>Idea 1: try each domain</h3> <p>Something like <code>http://example.com/favicon.ico</code>. But using a <code>favicon.ico</code> in the webroot folder is just a common implementation. Each website can host their favicon with another path, and another file format.</p> <p>Let's try something else...</p> <h3>Idea 2: parse html for favicon urls</h3> <p>If the website doesn't use <code>favicon.ico</code> in the webroot folder, the page html will contain a path to the favicon, with the following format:</p> <div class=highlight><pre><span></span><code><span class=err>&lt;link rel=icon href=/favicon.png&gt;</span>
</code></pre></div> <p>There is python package aptly named <a href=https://github.com/scottwernervt/favicon>favicon</a> that will parse the html and return the urls to all favicons, with different formats and resolutions. I'm pasting their demo code here:</p> <div class=highlight><pre><span></span><code><span class=o>&gt;&gt;&gt;</span> <span class=kn>import</span> <span class=nn>favicon</span>
<span class=o>&gt;&gt;&gt;</span> <span class=n>icons</span> <span class=o>=</span> <span class=n>favicon</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://www.python.org/&#39;</span><span class=p>)</span>
<span class=n>Icon</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://www.python.org/static/apple-touch-icon-144x144-precomposed.png&#39;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>144</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>144</span><span class=p>,</span> <span class=n>format</span><span class=o>=</span><span class=s1>&#39;png&#39;</span><span class=p>)</span>
<span class=n>Icon</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://www.python.org/static/apple-touch-icon-114x114-precomposed.png&#39;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>114</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>114</span><span class=p>,</span> <span class=n>format</span><span class=o>=</span><span class=s1>&#39;png&#39;</span><span class=p>)</span>
<span class=n>Icon</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://www.python.org/static/apple-touch-icon-72x72-precomposed.png&#39;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>72</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>72</span><span class=p>,</span> <span class=n>format</span><span class=o>=</span><span class=s1>&#39;png&#39;</span><span class=p>)</span>
<span class=n>Icon</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://www.python.org/static/apple-touch-icon-precomposed.png&#39;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>format</span><span class=o>=</span><span class=s1>&#39;png&#39;</span><span class=p>)</span>
<span class=n>Icon</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://www.python.org/static/favicon.ico&#39;</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>format</span><span class=o>=</span><span class=s1>&#39;ico&#39;</span><span class=p>)</span>
</code></pre></div> <p>Getting better... But if I download bulk favicons, I'd like to avoid normalizing their file format and resolutions.</p> <h3>Idea 3: get favicons directly from google's cache</h3> <p>Google keeps the favicon cached for many sites (even my little website with basically zero traffic).</p> <div class=highlight><pre><span></span><code><span class=c>https://www.google.com/s2/favicons?domain=smalldata.dev</span>
</code></pre></div> <p>And the favicons are all normalized: 16x16 pixels and png format. Perfect.</p> <h1>Now for some fun</h1> <p>A <a href=https://moz.com/top500>top500 website list</a> has a <a href=https://moz.com/top500/domains/csv>csv export</a> and wrote a Python script to download each of these 500 favicons from Google's cache and save to local folder <code>images/</code>.</p> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>requests</span>
<span class=kn>import</span> <span class=nn>pandas</span> <span class=kn>as</span> <span class=nn>pd</span>
<span class=kn>import</span> <span class=nn>os</span>
<span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>StringIO</span>

<span class=k>def</span> <span class=nf>request_function</span><span class=p>(</span><span class=n>domain</span><span class=p>):</span>
    <span class=n>domain</span> <span class=o>=</span> <span class=n>domain</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
    <span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;https://www.google.com/s2/favicons?domain=&#39;</span> <span class=o>+</span> <span class=n>domain</span>
    <span class=n>fav</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=o>.</span><span class=n>content</span>
    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;images&#39;</span><span class=o>+</span><span class=n>os</span><span class=o>.</span><span class=n>sep</span><span class=o>+</span><span class=n>domain</span><span class=o>+</span><span class=s1>&#39;.png&#39;</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>handler</span><span class=p>:</span>
        <span class=n>handler</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>fav</span><span class=p>)</span>
    <span class=k>return</span>

<span class=c1># top 500 websites from mozilla https://moz.com/top500</span>
<span class=n>url</span> <span class=o>=</span> <span class=s2>&quot;https://moz.com:443/top500/domains/csv&quot;</span>
<span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;User-Agent&quot;</span><span class=p>:</span> <span class=s2>&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:66.0) Gecko/20100101 Firefox/66.0&quot;</span><span class=p>}</span>
<span class=n>req</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
<span class=n>data</span> <span class=o>=</span> <span class=n>StringIO</span><span class=p>(</span><span class=n>req</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
<span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
<span class=n>df</span><span class=o>.</span><span class=n>URL</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span><span class=n>request_function</span><span class=p>)</span>
</code></pre></div> <h3>Favicon art</h3> <p>What to do with 500 favicons. For fun, I made a mosaic from the collection, and I first needed a original piece of art that would be recongnizable when heavily pixelated. Van Gogh's <a href=https://en.wikipedia.org/wiki/The_Starry_Night>Starry night</a> stood out.</p> <p>Here's the original:</p> <p><img alt="Starry Night" src=https://smalldata.dev/posts/favicon-mosaic/1137px-Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg></p> <p><em>Source</em>: <a href=https://en.wikipedia.org/wiki/The_Starry_Night#/media/File:Van_Gogh_-_Starry_Night_-_Google_Art_Project.jpg>Wikipedia</a></p> <p>Then I used a handy Python script called <a href=https://github.com/codebox/mosaic>mosaic.py</a>. No coding necessary.</p> <div class=highlight><pre><span></span><code><span class=err>git clone https://github.com/codebox/mosaic.git</span>
<span class=err>python mosaic/mosaic.py source.jpg images/</span>
</code></pre></div> <p>And what pops out is a <em>Starry Night of Favicons</em>.</p> <p><img alt="Favicon Starry Night" src=https://smalldata.dev/posts/favicon-mosaic/mosaic.jpeg></p> <hr> <p>(full resolution download: <a href=https://smalldata.dev/posts/favicon-mosaic/mosaic_full.jpeg>22 MB</a>)</p> <p>(python <a href=https://gist.github.com/philshem/e59388197fd9ddb7dcdb8098f9f0aaf2>source code</a>)</p> <p>(top500 favicons: <a href=https://smalldata.dev/posts/favicon-mosaic/top500_favicons.zip>zip</a>)</p> </div> </article> </aside> </div> <div class="column is-one-quarter-desktop is-one-third-tablet is-hidden-print"> <aside class=menu> <p class=menu-label>Links</p> <ul class=menu-list> <li><a href=https://medium.com/dirty-data/advisor-or-adviser-cc063acef267> <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span> <span class=link-text>Advisor or Adviser</span> </a></li> <li><a href=https://medium.com/dirty-data/data-are-beautiful-356332cdb81> <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span> <span class=link-text>Data are Beautiful</span> </a></li> <li><a href=https://medium.com/@philshem/life-in-the-baby-universe-f52561c4a8ae> <span class="icon is-small"><i class="fa fa-globe fa-fw"></i></span> <span class=link-text>The Physics of Babies</span> </a></li> </ul> <p class=menu-label>Social</p> <ul class=menu-list> <li><a href=https://twitter.com/philshem> <span class="icon is-small"> <i class="fa fa-twitter fa-fw"></i> </span> <span class=link-text>Twitter</span> </a></li> <li><a href=https://github.com/philshem> <span class="icon is-small"> <i class="fa fa-github fa-fw"></i> </span> <span class=link-text>GitHub</span> </a></li> <li><a href=https://opendata.stackexchange.com/users/1511/philshem> <span class="icon is-small"> <i class="fa fa-stack-overflow fa-fw"></i> </span> <span class=link-text>Stack Overflow</span> </a></li> <li><a href=mailto:philip@smalldata.dev> <span class="icon is-small"> <i class="fa fa-envelope fa-fw"></i> </span> <span class=link-text>E-mail</span> </a></li> <li><a href=https://smalldata.dev/feeds/all.atom.xml type=application/atom+xml rel=alternate> <span class="icon is-small"><i class="fa fa-rss"></i></span> <span class=link-text>Atom Feed</span> </a></li> <li><a href=https://smalldata.dev/feeds/all.rss.xml type=application/rss+xml rel=alternate> <span class="icon is-small"><i class="fa fa-rss"></i></span> <span class=link-text>RSS Feed</span> </a></li> </ul> <p class=menu-label>License</p> <ul class=menu-list> <li> <a href=http://creativecommons.org/licenses/by-sa/4.0/ rel=license> <span class="icon is-small"> <i class="fa fa-creative-commons fa-fw"></i> </span> <span>CC BY-SA 4.0</span> </a> </li> </ul> </aside> </div> </div> </div> <footer class=footer> <div class="container has-text-centered"> <p class=subtitle>“Torture the data, and it will confess to anything.” – Ronald Coase</p> <div class=credits> <span><a href=https://github.com/textbook/bulrush>Bulrush</a> theme for <a href=https://blog.getpelican.com/ >Pelican</a></span> <span><span class="icon is-small"><i class="fa fa-html5"></i></span> HTML 5</span> <span><span class="icon is-small"><i class="fa fa-css3"></i></span> CSS 3</span> <span>Made with <a href=https://bulma.io>Bulma</a></span> </div> </div> </footer> <script type=text/javascript>
  document.getElementById('navToggle').addEventListener('click', function () {
    var nav = document.getElementById('navMenu');
    var className = nav.getAttribute('class');
    if (className == 'navbar-menu') {
      nav.className = 'navbar-menu is-active';
    } else {
      nav.className = 'navbar-menu';
    }
  });
</script> </body> </html>